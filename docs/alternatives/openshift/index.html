<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.13.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Chaos Monkey Alternatives - OpenShift - Gremlin: Chaos Monkey</title>
<meta name="description" content="Explores Chaos Monkey alternative technologies using OpenShift.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Gremlin: Chaos Monkey">
<meta property="og:title" content="Chaos Monkey Alternatives - OpenShift">
<meta property="og:url" content="http://localhost:4000/gremlin-chaos-monkey/alternatives/openshift/">








  <meta property="article:published_time" content="2018-08-30T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/gremlin-chaos-monkey/alternatives/openshift/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Gabe Wyatt",
      "url": "http://localhost:4000/gremlin-chaos-monkey",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/gremlin-chaos-monkey/feed.xml" type="application/atom+xml" rel="alternate" title="Gremlin: Chaos Monkey Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/gremlin-chaos-monkey/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->
<link rel="icon" href="https://www.gremlin.com/favicon-32x32.png" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/gremlin-chaos-monkey/">Gremlin: Chaos Monkey</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/gremlin-chaos-monkey/notes">Notes to Editor</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://drive.google.com/drive/folders/16PhHEJGZtF428eyko_6-2BxpDGAU9JhW?usp=sharing" target="_blank" rel="noopener noreferrer">Google Drive Exports</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://localhost:4000/gremlin-chaos-monkey/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="/gremlin-chaos-monkey/alternatives" itemprop="item"><span itemprop="name">Alternatives</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Chaos Monkey Alternatives - OpenShift</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox">
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Hub Pages</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/" class="">Chaos Monkey Guide for Engineers</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/origin-netflix" class="">The Origin of Chaos Monkey</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/developer-tutorial" class="">Chaos Monkey Tutorial</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/advanced-tips" class="">Advanced Developer Guide</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/simian-army" class="">The Simian Army</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/downloads-resources" class="">Chaos Monkey Resources</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives" class="">Chaos Monkey Alternatives</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Alternatives</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/azure" class="">Azure</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/docker" class="">Docker</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/google-cloud-platform" class="">Google Cloud Platform</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/kubernetes" class="">Kubernetes</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/openshift" class="">OpenShift</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/private-cloud" class="">Private Cloud</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/spring-boot" class="">Spring Boot</a></li>
          
            
            

            
            

            <li><a href="/gremlin-chaos-monkey/alternatives/vmware" class="">VMWare</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Chaos Monkey Alternatives - OpenShift">
    
    <meta itemprop="datePublished" content="August 30, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Chaos Monkey Alternatives - OpenShift
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> </h4></header>
              <ul class="toc__menu">
  <li>
<a href="#monkey-ops">Monkey-Ops</a>
    <ul>
      <li><a href="#docker-installation">Docker Installation</a></li>
      <li><a href="#openshift-installation">OpenShift Installation</a></li>
    </ul>
  </li>
  <li><a href="#engineering-chaos-in-openshift-with-gremlin">Engineering Chaos In OpenShift with Gremlin</a></li>
  <li><a href="#pumba">Pumba</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="monkey-ops">Monkey-Ops</h2>

<p><a href="https://github.com/Produban/monkey-ops" target="_blank" rel="noopener noreferrer">Monkey-Ops</a> is an open-source Chaos Monkey implementation written in Go and designed to be deployed alongside an OpenShift application.  Monkey-Ops will randomly perform one of two possible attacks:</p>

<ul>
  <li>Delete a random pod by calling the <a href="https://docs.openshift.com/container-platform/3.6/rest_api/kubernetes_v1.html#delete-collection-of-pod" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">DELETE /api/v1/namespaces/{namespace}/pods</code></a> Kubernetes API endpoint.</li>
  <li>Scale the number of replicas for the associated deployment config by calling the <a href="https://docs.openshift.com/container-platform/3.6/rest_api/openshift_v1.html#replace-scale-of-the-specified-scale" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">PUT /oapi/v1/namespaces/{namespace}/deploymentconfigs/{name}/scale</code></a> OpenShift API endpoint.</li>
</ul>

<p>You can install Monkey-Ops either via Docker or as a separate OpenShift project.</p>

<h3 id="docker-installation">Docker Installation</h3>

<p>Create a Docker container with the following command.  Be sure to replace <code class="highlighter-rouge">TOKEN</code> with your own OpenShift auth token and <code class="highlighter-rouge">PROJECT_NAME</code> with the appropriate value.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run produban/monkey-ops /monkey-ops <span class="se">\</span>
  <span class="nt">--TOKEN</span><span class="o">=</span><span class="s2">"_uAGahsDihxorIVxQvasmiTRbijJCbwj1toFD0ifWw"</span> <span class="se">\</span>
  <span class="nt">--PROJECT_NAME</span><span class="o">=</span><span class="s2">"chaos-demo"</span> <span class="se">\</span>
  <span class="nt">--API_SERVER</span><span class="o">=</span><span class="s2">"https://api.starter-us-west-2.openshift.com:443"</span> <span class="se">\</span>
  <span class="nt">--INTERVAL</span><span class="o">=</span>30 <span class="se">\</span>
  <span class="nt">--MODE</span><span class="o">=</span><span class="s2">"background"</span>
</code></pre></div></div>

<p>This will randomly execute one of the two possible attacks every <code class="highlighter-rouge">INTERVAL</code> seconds.  If you wish to have more control over attacks, change <code class="highlighter-rouge">MODE</code> to <code class="highlighter-rouge">"rest"</code> and use the <a href="https://github.com/Produban/monkey-ops#api-rest" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">/chaos</code> REST API</a> to launch an attack.</p>

<h3 id="openshift-installation">OpenShift Installation</h3>

<p>Installing Monkey-Ops as an OpenShift project is a bit more complex.</p>

<ol>
  <li>
    <p>Clone the Git repo to a local directory.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> git clone https://github.com/Produban/monkey-ops.git
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a <code class="highlighter-rouge">monkey-ops.json</code> file and paste the following, which will be used to create a Service Account.</p>

    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="s2">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ServiceAccount"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"monkey-ops"</span><span class="w">
   </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Create the OpenShift Service Account using the <a href="https://docs.okd.io/latest/cli_reference/get_started_cli.html" target="_blank" rel="noopener noreferrer">OpenShift CLI</a> and grant it privileges for your project (e.g. <code class="highlighter-rouge">chaos-demo</code>).</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc create <span class="nt">-f</span> monkey-ops.json <span class="o">&amp;&amp;</span> oc policy add-role-to-user edit system:serviceaccount:chaos-demo:monkey-ops
</code></pre></div>    </div>
  </li>
  <li>
    <p>Now create a new pod using the <code class="highlighter-rouge">monkey-ops-template.yaml</code> found in the Monkey-Ops project.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc create <span class="nt">-f</span> ./openshift/monkey-ops-template.yaml <span class="nt">-n</span> chaos-demo
</code></pre></div>    </div>
  </li>
  <li>
    <p>Finally, create a new app called <code class="highlighter-rouge">monkey-ops</code> and pass appropriate values for each <code class="highlighter-rouge">PARAM</code> indicating when and how attacks will be executed.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc new-app <span class="se">\</span>
   <span class="nt">--name</span><span class="o">=</span>monkey-ops <span class="se">\</span>
   <span class="nt">--template</span><span class="o">=</span>monkey-ops <span class="se">\</span>
   <span class="nt">--param</span> <span class="nv">APP_NAME</span><span class="o">=</span>monkey-ops <span class="se">\</span>
   <span class="nt">--param</span> <span class="nv">INTERVAL</span><span class="o">=</span>30 <span class="se">\</span>
   <span class="nt">--param</span> <span class="nv">MODE</span><span class="o">=</span>background <span class="se">\</span>
   <span class="nt">--param</span> <span class="nv">TZ</span><span class="o">=</span>America/Los_Angeles <span class="se">\</span>
   <span class="nt">--labels</span><span class="o">=</span><span class="nv">app_name</span><span class="o">=</span>monkey-ops <span class="nt">-n</span> chaos-demo
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="engineering-chaos-in-openshift-with-gremlin">Engineering Chaos In OpenShift with Gremlin</h2>

<p>Gremlin’s <a href="https://www.gremlin.com" target="_blank" rel="noopener noreferrer">Failure as a Service</a> simplifies your Chaos Engineering workflow for OpenShift by making it safe and effortless to execute Chaos Experiments across all application containers.  As a distributed architecture OpenShift is particularly sensitive to instability and unexpected failures.  Gremlin can perform a variety of attacks on your OpenShift applications including overloading CPU, memory, disk, and IO; killing pods; modifying network traffic; and much more.</p>

<p>Check out <a href="https://help.gremlin.com/install-gremlin-centos-7/" target="_blank" rel="noopener noreferrer">this tutorial</a> for installing Gremlin on Centos to get started!</p>

<h2 id="pumba">Pumba</h2>

<p>As discussed in the <a href="/gremlin-chaos-monkey/alternatives/docker#pumba">Chaos Monkey Alternatives - Docker</a> chapter, <a href="https://github.com/alexei-led/pumba" target="_blank" rel="noopener noreferrer">Pumba</a> is a Chaos injection tool primarily built for Docker.  However, it can also be deployed on <a href="https://github.com/alexei-led/pumba/blob/master/deploy/pumba_kube.yml" target="_blank" rel="noopener noreferrer">Kubernetes</a> and, by extension, on <a href="https://github.com/alexei-led/pumba/blob/master/deploy/pumba_openshift.yml" target="_blank" rel="noopener noreferrer">OpenShift</a> using a DaemonSets.  Pumba can stop, pause, kill, and remove containers, which means it works fairly well with OpenShift pods that are made up of one or more containers.</p>

<ol>
  <li>
    <p>To deploy Pumba in OpenShift nodes using a DaemonSet you must first add a security policy to allow the OpenShift <code class="highlighter-rouge">developer</code> user to administer Kubernetes clusters.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc adm policy <span class="nt">--as</span> system:admin add-cluster-role-to-user cluster-admin developer
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add the <code class="highlighter-rouge">privileged</code> security context restraint to the <code class="highlighter-rouge">default</code> user for your project.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc adm policy add-scc-to-user privileged system:serviceaccount:&lt;project&gt;:default
</code></pre></div>    </div>
  </li>
  <li>
    <p>Set the <code class="highlighter-rouge">allowHostDirVolumePlugin</code> option to <code class="highlighter-rouge">true</code> in the <code class="highlighter-rouge">restricted</code> security restraint, which will allow OpenShift to connect to the Docker container.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc edit scc restricted
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="c"># Please edit the object below. Lines beginning with a '#' will be ignored,</span>
 <span class="c"># and an empty file will abort the edit. If an error occurs while saving this file will be</span>
 <span class="c"># reopened with the relevant failures.</span>
 <span class="c">#</span>
 allowHostDirVolumePlugin: <span class="nb">true
 </span>allowHostIPC: <span class="nb">false
 </span>allowHostNetwork: <span class="nb">false
 </span>allowHostPID: <span class="nb">false
 </span>allowHostPorts: <span class="nb">false
 </span>allowPrivilegedContainer: <span class="nb">false
 </span>allowedCapabilities: null
 apiVersion: security.openshift.io/v1
 <span class="c"># [...]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Download the <a href="https://raw.githubusercontent.com/alexei-led/pumba/master/deploy/pumba_openshift.yml" target="_blank" rel="noopener noreferrer">pumba_openshift.yml</a> file and modify it as necessary.  By default every 30 seconds it will kill a container within a pod containing the string <code class="highlighter-rouge">"hello"</code> in its name.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> curl <span class="nt">-O</span> https://raw.githubusercontent.com/alexei-led/pumba/master/deploy/pumba_openshift.yml
</code></pre></div>    </div>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
 <span class="na">kind</span><span class="pi">:</span> <span class="s">DaemonSet</span>
 <span class="na">metadata</span><span class="pi">:</span>
   <span class="na">name</span><span class="pi">:</span> <span class="s">pumba</span>
 <span class="na">spec</span><span class="pi">:</span>
   <span class="na">template</span><span class="pi">:</span>
     <span class="na">metadata</span><span class="pi">:</span>
       <span class="na">labels</span><span class="pi">:</span>
         <span class="na">app</span><span class="pi">:</span> <span class="s">pumba</span>
       <span class="na">name</span><span class="pi">:</span> <span class="s">pumba</span>
     <span class="na">spec</span><span class="pi">:</span>
       <span class="na">containers</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">gaiaadm/pumba:master</span>
         <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
         <span class="na">name</span><span class="pi">:</span> <span class="s">pumba</span>
         <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">pumba"</span><span class="pi">]</span> 
         <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">--random"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--interval"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">30s"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">kill"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--signal"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">SIGKILL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">re2:.*hello.*"</span><span class="pi">]</span>
         <span class="na">securityContext</span><span class="pi">:</span>
           <span class="na">runAsUser</span><span class="pi">:</span> <span class="s">0</span>
         <span class="na">volumeMounts</span><span class="pi">:</span>
           <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dockersocket</span>
             <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/run/docker.sock</span>
       <span class="na">volumes</span><span class="pi">:</span>
         <span class="pi">-</span> <span class="na">hostPath</span><span class="pi">:</span>
             <span class="na">path</span><span class="pi">:</span> <span class="s">/var/run/docker.sock</span>
           <span class="na">name</span><span class="pi">:</span> <span class="s">dockersocket</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Finally, create the DaemonSet from the <code class="highlighter-rouge">pumba_openshift.yml</code>.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> oc create <span class="nt">-f</span> pumba_openshift.yml
 daemonset.extensions <span class="s2">"pumba"</span> created
</code></pre></div>    </div>
  </li>
</ol>

<p>That’s it.  Now just add some pods to your project that match the regex used in the DaemonSet, if any, and Pumba should pick up on them and start killing them off.  Check out this handy <a href="https://www.youtube.com/watch?v=kA0P-V2JPTA" target="_blank" rel="noopener noreferrer">video tutorial</a> for all the details.</p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-08-30T00:00:00-07:00">August 30, 2018</time></p>
        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
    
    
    
    
    
    <li><a href="/gremlin-chaos-monkey/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2018 Gabe Wyatt</div>

      </footer>
    </div>

    
  <script src="/gremlin-chaos-monkey/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>








  </body>
</html>