<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Chaos Monkey Tutorial - A Step-by-Step Guide to Creating Failure on AWS | Gremlin: Chaos Monkey</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Chaos Monkey Tutorial - A Step-by-Step Guide to Creating Failure on AWS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A step-by-step guide on setting up and using Chaos Monkey with AWS, and also explores specific scenarios in which Chaos Monkey may (or may not) be relevant." />
<meta property="og:description" content="A step-by-step guide on setting up and using Chaos Monkey with AWS, and also explores specific scenarios in which Chaos Monkey may (or may not) be relevant." />
<link rel="canonical" href="http://localhost:4000/gremlin-chaos-monkey/developer-tutorial/" />
<meta property="og:url" content="http://localhost:4000/gremlin-chaos-monkey/developer-tutorial/" />
<meta property="og:site_name" content="Gremlin: Chaos Monkey" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-30T00:00:00-07:00" />
<script type="application/ld+json">
{"description":"A step-by-step guide on setting up and using Chaos Monkey with AWS, and also explores specific scenarios in which Chaos Monkey may (or may not) be relevant.","@type":"BlogPosting","url":"http://localhost:4000/gremlin-chaos-monkey/developer-tutorial/","headline":"Chaos Monkey Tutorial - A Step-by-Step Guide to Creating Failure on AWS","dateModified":"2018-08-30T00:00:00-07:00","datePublished":"2018-08-30T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/gremlin-chaos-monkey/developer-tutorial/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/gremlin-chaos-monkey/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/gremlin-chaos-monkey/feed.xml" title="Gremlin: Chaos Monkey" /><link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/gremlin-chaos-monkey/">Gremlin: Chaos Monkey</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/gremlin-chaos-monkey/advanced-tips/">Taking Chaos Monkey to the Next Level - Advanced Developer Guide</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/azure/">Chaos Monkey Alternatives - Azure</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/docker/">Chaos Monkey Alternatives - Docker</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/google-cloud-platform/">Chaos Monkey Alternatives - Google Cloud Platform</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/kubernetes/">Chaos Monkey Alternatives - Kubernetes</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/openshift/">Chaos Monkey Alternatives - OpenShift</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/private-cloud/">Chaos Monkey Alternatives - Private Cloud</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/sprint-boot/">Chaos Monkey Alternatives - Spring Boot</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/vmware/">Chaos Monkey Alternatives - VMWare</a><a class="page-link" href="/gremlin-chaos-monkey/alternatives/">Chaos Monkey Alternatives - Tools for Creating Chaos Outside of AWS</a><a class="page-link" href="/gremlin-chaos-monkey/developer-tutorial/">Chaos Monkey Tutorial - A Step-by-Step Guide to Creating Failure on AWS</a><a class="page-link" href="/gremlin-chaos-monkey/downloads-resources/">Chaos Monkey Resources, Guides, and Downloads for Engineers</a><a class="page-link" href="/gremlin-chaos-monkey/origin-netflix/">The Origin of Chaos Monkey - Why Netflix Needed to Create Failure</a><a class="page-link" href="/gremlin-chaos-monkey/simian-army/">The Simian Army - Overview and Resources</a><a class="page-link" href="/gremlin-chaos-monkey/">Chaos Monkey Guide for Engineers - Tips, Tutorials, and Training</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <ul>
  <li><a href="#">Chaos Monkey Tutorial - A Step-by-Step Guide to Creating Failure on AWS</a>
    <ul>
      <li><a href="#setting-up-chaos-monkey">Setting Up Chaos Monkey</a>
        <ul>
          <li><a href="#ssh-configuration">SSH Configuration</a></li>
          <li><a href="#aws-ec2-bastion--spinnaker">AWS EC2 Bastion &amp; Spinnaker</a></li>
          <li><a href="#chaos-monkey--spinnaker-setup">Chaos Monkey + Spinnaker Setup</a></li>
          <li><a href="#spinnaker-configuration">Spinnaker COnfiguration</a></li>
          <li><a href="#known-issues">Known Issues</a></li>
          <li><a href="#spinnaker-add-application">Spinnaker: Add Application</a>
            <ul>
              <li><a href="#add-firewall">Add Firewall</a></li>
              <li><a href="#add-load-balancer">Add Load Balancer</a></li>
              <li><a href="#add-pipeline">Add Pipeline</a>
                <ul>
                  <li><a href="#add-stage-1">Add Stage 1</a></li>
                  <li><a href="#add-stage-2">Add Stage 2</a></li>
                  <li><a href="#creating-a-server-group">Creating a Server Group</a></li>
                  <li><a href="#try-it-out">Try It Out</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#how-to-deploy-chaos-monkey">How to Deploy Chaos Monkey</a></li>
      <li><a href="#manual-spinnaker-installation">Manual Spinnaker Installation</a>
        <ul>
          <li><a href="#chaos-monkey--go--mysql-8-authentication-error">Chaos Monkey + Go + MySQL 8 Authentication Error</a></li>
        </ul>
      </li>
      <li><a href="#spinnaker-full-installation-via-aws-cli">Spinnaker Full Installation via AWS CLI</a>
        <ul>
          <li><a href="#create-aws-cloudformation-spinnaker-stack">Create AWS CloudFormation Spinnaker Stack</a></li>
          <li><a href="#select-installation-environment">Select Installation Environment</a></li>
          <li><a href="#setup-persistent-storage-for-spinnaker">Setup Persistent Storage for Spinnaker</a></li>
          <li><a href="#deploy-spinnaker">Deploy Spinnaker</a></li>
        </ul>
      </li>
      <li><a href="#spinnaker-full-installation">Spinnaker Full Installation</a>
        <ul>
          <li><a href="#install-halyard">Install Halyard</a></li>
          <li><a href="#create-aws-cloudformation-spinnaker-stack-1">Create AWS CloudFormation Spinnaker Stack</a></li>
          <li><a href="#setup-persistent-storage-for-spinnaker-1">Setup Persistent Storage for Spinnaker</a></li>
          <li><a href="#deploy-spinnaker-1">Deploy Spinnaker</a></li>
          <li><a href="#create-spinnaker-application">Create Spinnaker Application</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Chaos Monkey Tutorial - A Step-by-Step Guide to Creating Failure on AWS</h1>
  </header>

  <div class="post-content">
    <ul>
  <li>URL: <code class="highlighter-rouge">https://www.gremlin.com/chaos-monkey/developer-tutorial</code></li>
  <li>Parent: <code class="highlighter-rouge">Pillar Page: Chaos Monkey Guide for Engineers - Tips, Tutorials, and Training</code></li>
  <li>Content:
    <ul>
      <li><code class="highlighter-rouge">Intro</code>
        <ul>
          <li>What: Describe the purpose of the tutorial, which is to give not only a step-by-step guide on setting up and using Chaos Monkey with AWS, but we’ll also go beyond initial setup to explore specific <em>scenarios</em> in which Chaos Monkey may (or may not) be relevant.</li>
          <li>Who: Define intended audiences (primarily technically-minded professionals or hobbyists, engineers, developers, etc).</li>
          <li>When/Why: The entire page will expound on the <em>when</em> and <em>why</em>, detailing scenarios (as listed below) in which using Chaos Monkey is appropriate, and providing the <em>how to</em> technical steps to make it work.</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">Basic Usage Guide</code>
        <ul>
          <li>Provide full walk through detailing propagation, configuration, setup, and execution of Chaos Monkey within an AWS instance.</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">Monitoring Health and Stability</code></li>
      <li><code class="highlighter-rouge">Detecting Service Latency</code></li>
      <li><a href="https://www.battery.com/powered/youve-heard-of-the-netflix-chaos-monkey-we-propose-for-cyber-security-an-infected-monkey/"><code class="highlighter-rouge">Discovering Security Vulnerabilities</code></a></li>
      <li><a href="https://www.baeldung.com/spring-boot-chaos-monkey"><code class="highlighter-rouge">Examining Exception Handling</code></a></li>
      <li><a href="https://medium.com/production-ready/using-chaos-monkey-whenever-you-feel-like-it-e5fe31257a07"><code class="highlighter-rouge">On Demand Chaos</code></a></li>
      <li><a href="https://blog.serverdensity.com/building-chaos-monkey/"><code class="highlighter-rouge">Building Your Own Customized Monkey</code></a></li>
      <li><code class="highlighter-rouge">Additional Resources</code>: Section to include an abundance of additional links and resources, with careful consideration for <em>types</em> of curated content.  Resources should include written tutorials, books, research papers, talks/conferences, podcasts, videos, and so forth.</li>
    </ul>
  </li>
</ul>

<h2 id="setting-up-chaos-monkey">Setting Up Chaos Monkey</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">######### WELCOME TO SPINNAKER ############</span>

Initializing systems!

Default region is configured <span class="k">for </span>Amazon AWS region:

GCE is disabled on this host. Refer to http://spinnaker.io/
<span class="k">for </span>more specific instructions.

You are <span class="k">in </span>a VPC setting this <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span>
Amazon VPC ID is <span class="nb">set </span>to: vpc-08e215071274f2822

Amazon AWS Subnet is <span class="nb">set </span>to: subnet-0cee7f54078833309

Reconfiguring deck <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span>

Rewriting deck settings <span class="k">in</span> <span class="s2">"/opt/deck/html/settings.js"</span><span class="nb">.</span>
Restarting Spinnaker <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span>

spinnaker start/running

Edit /etc/default/spinnaker and restart Spinnaker <span class="k">if </span>you wish to change this
Then execute:
<span class="nb">sudo </span>service clouddriver restart
<span class="nb">sudo </span>service rosco restart

<span class="nt">------</span> You should be ready to go <span class="nt">-----</span>
To connect create a SSH tunnel from your host to ec2-34-217-178-128.us-west-2.compute.amazonaws.com remote ports 9000 and 8084

You may add this to ~/.ssh/config:
Host spinnaker
    HostName ec2-34-217-178-128.us-west-2.compute.amazonaws.com
    IdentityFile /path/to/private/key
    LocalForward 9000 127.0.0.1:9000
    LocalForward 8084 127.0.0.1:8084
    LocalForward 8087 127.0.0.1:8087
    User ubuntu

If the ssh config file is new. Ensure it is chmod 400

Execute: ssh <span class="nt">-f</span> <span class="nt">-N</span> spinnaker
Open http://localhost:9000/ <span class="k">in </span>your web browser

This message will now self-destruct. Enjoy
</code></pre></div></div>

<h3 id="ssh-configuration">SSH Configuration</h3>

<ul>
  <li>May need to modify auto-generated <code class="highlighter-rouge">SpinnakerWebServerSecurityGroup</code> AWS Secury Group to add your local IP address/range [SCREENSHOT].</li>
</ul>

<h3 id="aws-ec2-bastion--spinnaker">AWS EC2 Bastion &amp; Spinnaker</h3>

<table>
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Status</th>
      <th>Type</th>
      <th>Logical ID</th>
      <th>Status Reason</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>16:31:51 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::CloudFormation::Stack</td>
      <td>Spinnaker</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:31:48 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::Instance</td>
      <td>SpinnakerWebServer</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:31:32 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Instance</td>
      <td>SpinnakerWebServer</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:31:31 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::Route</td>
      <td>SpinnakerPrivateRoute</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:31:30 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Instance</td>
      <td>SpinnakerWebServer</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:31:28 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::IAM::InstanceProfile</td>
      <td>SpinnakerInstanceProfile</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:31:15 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Route</td>
      <td>SpinnakerPrivateRoute</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:31:15 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Route</td>
      <td>SpinnakerPrivateRoute</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:31:13 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::NatGateway</td>
      <td>NAT</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:58 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::Instance</td>
      <td>BastionServer</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:46 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::IAM::AccessKey</td>
      <td>SpinnakerAccessKey</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:45 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::AccessKey</td>
      <td>SpinnakerAccessKey</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:45 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::AccessKey</td>
      <td>SpinnakerAccessKey</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:43 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::Route</td>
      <td>SpinnakerPublicRoute</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:43 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::IAM::User</td>
      <td>SpinnakerUser</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:43 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::SubnetRouteTableAssociation</td>
      <td>SpinnakerPublicSubnetRouteTableAssociation</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:39 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::SubnetRouteTableAssociation</td>
      <td>SpinnakerPrivateSubnetRouteTableAssociation</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:27 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Route</td>
      <td>SpinnakerPublicRoute</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:27 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::InstanceProfile</td>
      <td>SpinnakerInstanceProfile</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:27 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SubnetRouteTableAssociation</td>
      <td>SpinnakerPublicSubnetRouteTableAssociation</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:27 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::InstanceProfile</td>
      <td>SpinnakerInstanceProfile</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:27 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Route</td>
      <td>SpinnakerPublicRoute</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:26 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SubnetRouteTableAssociation</td>
      <td>SpinnakerPublicSubnetRouteTableAssociation</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:25 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::IAM::Role</td>
      <td>SpinnakerRole</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:25 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Instance</td>
      <td>BastionServer</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:24 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::RouteTable</td>
      <td>SpinnakerPublicRouteTable</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:24 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::NatGateway</td>
      <td>NAT</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:24 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::NatGateway</td>
      <td>NAT</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:24 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SubnetRouteTableAssociation</td>
      <td>SpinnakerPrivateSubnetRouteTableAssociation</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:23 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::RouteTable</td>
      <td>SpinnakerPublicRouteTable</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:23 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Instance</td>
      <td>BastionServer</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:23 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::RouteTable</td>
      <td>SpinnakerPublicRouteTable</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:23 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SubnetRouteTableAssociation</td>
      <td>SpinnakerPrivateSubnetRouteTableAssociation</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:21 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::Subnet</td>
      <td>SpinnakerPublicSubnet</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:21 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::Subnet</td>
      <td>SpinnakerPrivateSubnet</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:21 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::VPCGatewayAttachment</td>
      <td>SpinnakerAttachGateway</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:18 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::SecurityGroup</td>
      <td>SpinnakerWebServerSecurityGroup</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:17 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SecurityGroup</td>
      <td>SpinnakerWebServerSecurityGroup</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:12 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SecurityGroup</td>
      <td>SpinnakerWebServerSecurityGroup</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:10 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::SecurityGroup</td>
      <td>SpinnakerBastionSecurityGroup</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:09 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SecurityGroup</td>
      <td>SpinnakerBastionSecurityGroup</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:06 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::User</td>
      <td>SpinnakerUser</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:06 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::Role</td>
      <td>SpinnakerRole</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:06 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::RouteTable</td>
      <td>SpinnakerPrivateRouteTable</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::User</td>
      <td>SpinnakerUser</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::VPCGatewayAttachment</td>
      <td>SpinnakerAttachGateway</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::Role</td>
      <td>SpinnakerRole</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Subnet</td>
      <td>SpinnakerPrivateSubnet</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Subnet</td>
      <td>SpinnakerPublicSubnet</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::VPCGatewayAttachment</td>
      <td>SpinnakerAttachGateway</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:05 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Subnet</td>
      <td>SpinnakerPrivateSubnet</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:04 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::RouteTable</td>
      <td>SpinnakerPrivateRouteTable</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:29:04 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::Subnet</td>
      <td>SpinnakerPublicSubnet</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:04 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::SecurityGroup</td>
      <td>SpinnakerBastionSecurityGroup</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:04 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::RouteTable</td>
      <td>SpinnakerPrivateRouteTable</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:03 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::IAM::Role</td>
      <td>BaseIAMRole</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:03 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::VPC</td>
      <td>SpinnakerVPC</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:02 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::EIP</td>
      <td>NATEIP</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:29:02 UTC-0700</td>
      <td>CREATE_COMPLETE</td>
      <td>AWS::EC2::InternetGateway</td>
      <td>SpinnakerInternetGateway</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:28:46 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::EIP</td>
      <td>NATEIP</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:28:46 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::VPC</td>
      <td>SpinnakerVPC</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:28:46 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::InternetGateway</td>
      <td>SpinnakerInternetGateway</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:28:46 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::Role</td>
      <td>BaseIAMRole</td>
      <td>Resource creation Initiated</td>
    </tr>
    <tr>
      <td>16:28:45 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::EIP</td>
      <td>NATEIP</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:28:45 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::VPC</td>
      <td>SpinnakerVPC</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:28:45 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::EC2::InternetGateway</td>
      <td>SpinnakerInternetGateway</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:28:45 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::IAM::Role</td>
      <td>BaseIAMRole</td>
      <td> </td>
    </tr>
    <tr>
      <td>16:28:43 UTC-0700</td>
      <td>CREATE_IN_PROGRESS</td>
      <td>AWS::CloudFormation::Stack</td>
      <td>Spinnaker</td>
      <td>User Initiated</td>
    </tr>
  </tbody>
</table>

<h3 id="chaos-monkey--spinnaker-setup">Chaos Monkey + Spinnaker Setup</h3>

<ul>
  <li>Click <strong>Config</strong> in top-right of Spinnaker <code class="highlighter-rouge">Deck</code> application page.</li>
  <li>Select <strong>Chaos Monkey</strong> in side navigation. [SCREENSHOT]</li>
</ul>

<h3 id="spinnaker-configuration">Spinnaker COnfiguration</h3>

<ul>
  <li><code class="highlighter-rouge">/opt/spinnaker</code></li>
  <li><code class="highlighter-rouge">/opt/deck/html/settings.js</code></li>
  <li><code class="highlighter-rouge">/opt/rosco</code>: Bakery service that handles pipelines.</li>
</ul>

<h3 id="known-issues">Known Issues</h3>

<ul>
  <li><code class="highlighter-rouge">Bake</code> stage can fail with <code class="highlighter-rouge">Error launching source spot instance</code> due to <code class="highlighter-rouge">invalid spot instance price</code> (see: <a href="https://github.com/spinnaker/spinnaker/issues/2889">#2889</a>).
    <ul>
      <li>Resolution: Remove <code class="highlighter-rouge">spot</code> reference lines in <code class="highlighter-rouge">/opt/rosco/config/packer/aws-ebs.json</code>.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">Bake</code> stage can fail with <code class="highlighter-rouge">Unknown configuration key: "ena_support"</code> error (see: <a href="https://github.com/spinnaker/spinnaker/issues/2237">#2237</a>).
    <ul>
      <li>Resolution: Remove <code class="highlighter-rouge">ena_support</code> reference line in <code class="highlighter-rouge">/opt/rosco/config/packer/aws-ebs.json</code>.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">Bake</code> stage can fail with:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==&gt;</span> amazon-ebs: Prevalidating AMI Name...
<span class="o">==&gt;</span> amazon-ebs: Inspecting the <span class="nb">source </span>AMI...
<span class="o">==&gt;</span> amazon-ebs: Creating temporary keypair: packer 5b8e2add-3401-259c-7142-12708cc57144
<span class="o">==&gt;</span> amazon-ebs: Creating temporary security group <span class="k">for </span>this instance...
<span class="o">==&gt;</span> amazon-ebs: Authorizing access to port 22 the temporary security group...
<span class="o">==&gt;</span> amazon-ebs: Launching a <span class="nb">source </span>AWS instance...
    amazon-ebs: Instance ID: i-0524794dbeffb3381
<span class="o">==&gt;</span> amazon-ebs: Waiting <span class="k">for </span>instance <span class="o">(</span>i-0524794dbeffb3381<span class="o">)</span> to become ready...
<span class="o">==&gt;</span> amazon-ebs: Waiting <span class="k">for </span>SSH to become available...
<span class="o">==&gt;</span> amazon-ebs: Connected to SSH!
<span class="o">==&gt;</span> amazon-ebs: Pausing 30s before the next provisioner...
<span class="o">==&gt;</span> amazon-ebs: Provisioning with shell script: /opt/rosco/config/packer/install_packages.sh
    amazon-ebs: <span class="nv">repository</span><span class="o">=</span>
    amazon-ebs: <span class="nv">package_type</span><span class="o">=</span>deb
    amazon-ebs: <span class="nv">packages</span><span class="o">=</span>redis-server
    amazon-ebs: <span class="nv">upgrade</span><span class="o">=</span>
    amazon-ebs: <span class="nv">artifacts</span><span class="o">=</span>
    amazon-ebs: <span class="nb">cat</span>: /tmp/artifacts.json: No such file or directory
<span class="o">==&gt;</span> amazon-ebs: Terminating the <span class="nb">source </span>AWS instance...
<span class="o">==&gt;</span> amazon-ebs: No AMIs to cleanup
<span class="o">==&gt;</span> amazon-ebs: Deleting temporary security group...
<span class="o">==&gt;</span> amazon-ebs: Deleting temporary keypair...
Build <span class="s1">'amazon-ebs'</span> errored: Script exited with non-zero <span class="nb">exit </span>status: 1

<span class="o">==&gt;</span> Some builds didn<span class="s1">'t complete successfully and had errors:
--&gt; amazon-ebs: Script exited with non-zero exit status: 1

==&gt; Builds finished but no artifacts were created.
</span></code></pre></div></div>

<ul>
  <li>Resolution: Execute the following command to override old <code class="highlighter-rouge">install_packages.sh</code> script with newer version.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>curl https://raw.githubusercontent.com/spinnaker/rosco/master/rosco-web/config/packer/install_packages.sh <span class="nt">--output</span> /opt/rosco/config/packer/install_packages.sh
</code></pre></div></div>

<h3 id="spinnaker-add-application">Spinnaker: Add Application</h3>

<ul>
  <li>Click <strong>Actions &gt; Create Application</strong>.</li>
  <li>Input <code class="highlighter-rouge">bookstore</code> in the <strong>Name</strong> field.</li>
  <li>Input your own email address in the <strong>Owner Email</strong> field.</li>
  <li>Ensure <code class="highlighter-rouge">Chaos Monkey &gt; Enabled</code> is checked.</li>
  <li>Input <code class="highlighter-rouge">My bookstore application</code> in the <strong>Description</strong> field.</li>
  <li>Under <strong>Instance Health</strong>, tick the <code class="highlighter-rouge">Consider only cloud provider health when executing tasks</code> checkbox.</li>
  <li>Click <strong>Create</strong> to add your new application.</li>
</ul>

<h4 id="add-firewall">Add Firewall</h4>

<ul>
  <li>Navigate to the <code class="highlighter-rouge">bookstore</code> application, <strong>INFRASTRUCTURE &gt; FIREWALLS</strong> and click <strong>Create Firewall</strong>.</li>
  <li>Input <code class="highlighter-rouge">dev</code> in the <strong>Detail</strong> field.</li>
  <li>Input <code class="highlighter-rouge">Bookstore dev environment</code> in the <strong>Description</strong> field.</li>
  <li>Within the <strong>VPC</strong> dropdown select <code class="highlighter-rouge">SpinnakerVPC</code>.</li>
  <li>Under the <strong>Ingress</strong> header click <strong>Add new Firewall Rule</strong>. Set the following <strong>Firewall Rule</strong> settings:
    <ul>
      <li><strong>Firewall</strong>: <code class="highlighter-rouge">default</code></li>
      <li><strong>Protocol</strong>: <code class="highlighter-rouge">TCP</code></li>
      <li><strong>Start Port</strong>: <code class="highlighter-rouge">80</code></li>
      <li><strong>End Port</strong>: <code class="highlighter-rouge">80</code></li>
    </ul>
  </li>
  <li>Click the <strong>Create</strong> button to finalize the firewall settings. [SCREENSHOT]</li>
</ul>

<h4 id="add-load-balancer">Add Load Balancer</h4>

<ul>
  <li>Navigate to the <code class="highlighter-rouge">bookstore</code> application, <strong>INFRASTRUCTURE &gt; LOAD BALANCERS</strong> and click <strong>Create Load Balancer</strong>.</li>
  <li>Select <strong>Classic (Legacy)</strong> and click <strong>Configure Load Balancer</strong>.</li>
  <li>Input <code class="highlighter-rouge">test</code> in the <strong>Stack</strong> field.</li>
  <li>In the <strong>VPC Subnet</strong> dropdown select <code class="highlighter-rouge">internal (vpc-...)</code>.</li>
  <li>In the <strong>Firewalls</strong> dropdown select <code class="highlighter-rouge">bookstore--dev (...)</code>.</li>
  <li>Click <strong>Create</strong> to generate the load balancer. [SCREENSHOT]</li>
</ul>

<h4 id="add-pipeline">Add Pipeline</h4>

<ul>
  <li>Navigate to the <code class="highlighter-rouge">bookstore</code> application, <strong>PIPELINES</strong> and click <strong>Create Pipeline</strong>.</li>
  <li>Select <code class="highlighter-rouge">Pipeline</code> in the <strong>Type</strong> dropdown.</li>
  <li>Input <code class="highlighter-rouge">Bookstore Dev to Test</code> in the <strong>Pipeline Name</strong> field.</li>
  <li>Click <strong>Create</strong>. [SCREENSHOT]</li>
</ul>

<h5 id="add-stage-1">Add Stage 1</h5>

<ul>
  <li>Click the <strong>Add stage</strong> button.</li>
  <li>Under <strong>Type</strong> select <code class="highlighter-rouge">Bake</code>.</li>
  <li>Input <code class="highlighter-rouge">redis-server</code> in the <strong>Package</strong> field.</li>
  <li>Select <code class="highlighter-rouge">trusty (v14.04)</code> in the <strong>Base OS</strong> dropdown.</li>
  <li>Click <strong>Save Changes</strong> to finalize the stage.</li>
</ul>

<h5 id="add-stage-2">Add Stage 2</h5>

<ul>
  <li>Click the <strong>Add stage</strong> button.</li>
  <li>Under <strong>Type</strong> select <code class="highlighter-rouge">Deploy</code>.</li>
  <li>Click the <strong>Add server group</strong> button to begin creating a new server group.</li>
</ul>

<h5 id="creating-a-server-group">Creating a Server Group</h5>

<ul>
  <li>Select <code class="highlighter-rouge">internal (vpc-...)</code> in the <strong>VPC Subnet</strong> dropdown.</li>
  <li>Input <code class="highlighter-rouge">dev</code> in the <strong>Stack</strong> field.</li>
  <li>Under <strong>Load Balancers &gt; Classic Load Balancers</strong> select the <code class="highlighter-rouge">bookstore-dev</code> load balancer we created.</li>
  <li>Under <strong>Firewalls &gt; Firewalls</strong> select the <code class="highlighter-rouge">bookstore--dev</code> firewall we also created.</li>
  <li>Under <strong>Instance Type</strong> select the <strong>Custom Type</strong> of instance you think you’ll need.  For this example we’ll go with something small and cheap, like <code class="highlighter-rouge">t3.micro</code>.</li>
  <li>Input <code class="highlighter-rouge">3</code> in the <strong>Capacity &gt; Number of Instances</strong> field.</li>
  <li>Under <strong>Advanced Settings &gt; Key Name</strong> select the <code class="highlighter-rouge">spinnaker_developer</code> key name.</li>
  <li>Click the <strong>Add</strong> button to create the deployment cluster configuration.</li>
  <li>Finally, click <strong>Save Changes</strong> again at the bottom of the <strong>Pipelines</strong> interface to save the full <code class="highlighter-rouge">Configuration &gt; Bake &gt; Deploy</code> pipeline.</li>
  <li><em>Note: You may see a warning within the <code class="highlighter-rouge">Bake</code> stage that a <code class="highlighter-rouge">CI</code> trigger (such as Jenkins/Travis) is usually required, but we don’t care in this simple example scenario.</em></li>
</ul>

<h5 id="try-it-out">Try It Out</h5>

<p><strong>Successful Bake Stage</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==&gt;</span> amazon-ebs: Prevalidating AMI Name...
<span class="o">==&gt;</span> amazon-ebs: Inspecting the <span class="nb">source </span>AMI...
<span class="o">==&gt;</span> amazon-ebs: Creating temporary keypair: packer 5b8e2fbf-372c-b3c9-32b3-b01e379e886d
<span class="o">==&gt;</span> amazon-ebs: Creating temporary security group <span class="k">for </span>this instance...
<span class="o">==&gt;</span> amazon-ebs: Authorizing access to port 22 the temporary security group...
<span class="o">==&gt;</span> amazon-ebs: Launching a <span class="nb">source </span>AWS instance...
    amazon-ebs: Instance ID: i-08d49753da1bfe24d
<span class="o">[</span>...]
Build <span class="s1">'amazon-ebs'</span> finished.

<span class="o">==&gt;</span> Builds finished. The artifacts of successful builds are:
<span class="nt">--</span><span class="o">&gt;</span> amazon-ebs: AMIs were created:

us-west-2: ami-04c042b2789ec7760
</code></pre></div></div>

<p><strong>Successful Deploy Stage</strong>:</p>

<p><strong>Cluster Instance Console Output</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>    0.000000] Initializing cgroup subsys cpuset
<span class="o">[</span>    0.000000] Initializing cgroup subsys cpu
<span class="o">[</span>    0.000000] Initializing cgroup subsys cpuacct
<span class="o">[</span>    0.000000] Linux version 3.13.0-137-generic <span class="o">(</span>buildd@lgw01-amd64-058<span class="o">)</span> <span class="o">(</span>gcc version 4.8.4 <span class="o">(</span>Ubuntu 4.8.4-2ubuntu1~14.04.3<span class="o">)</span> <span class="o">)</span> <span class="c">#186-Ubuntu SMP Mon Dec 4 19:09:19 UTC 2017 (Ubuntu 3.13.0-137.186-generic 3.13.11-ckt39)</span>
<span class="o">[</span>    0.000000] Command line: <span class="nv">BOOT_IMAGE</span><span class="o">=</span>/boot/vmlinuz-3.13.0-137-generic <span class="nv">root</span><span class="o">=</span><span class="nv">UUID</span><span class="o">=</span>08df443d-a08d-4a06-ab5b-6fdacfc684d3 ro <span class="nv">console</span><span class="o">=</span>tty1 <span class="nv">console</span><span class="o">=</span>ttyS0
<span class="o">[</span>    0.000000] KERNEL supported cpus:
...
Cloud-init v. 0.7.5 finished at Tue, 04 Sep 2018 19:58:40 +0000. Datasource DataSourceEc2.  Up 21.79 seconds
</code></pre></div></div>

<p><strong>Failed Deploy Stage</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User: arn:aws:iam::709203678428:user/SpinnakerDevelopment-SpinnakerUser-18ZQ3LBIXDZZV is not authorized to perform: iam:PassRole on resource: arn:aws:iam::709203678428:role/BaseIAMRole <span class="o">(</span>Service: AmazonAutoScaling<span class="p">;</span> Status Code: 403<span class="p">;</span> Error Code: AccessDenied<span class="p">;</span> Request ID: 0ef99eda-b012-11e8-a6f7-6b1d7fcc227f<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invalid IamInstanceProfile: SpinnakerDevelopment-BaseIAMRole-6D9LJ9HS4PZ7 <span class="o">(</span>Service: AmazonAutoScaling<span class="p">;</span> Status Code: 400<span class="p">;</span> Error Code: ValidationError<span class="p">;</span> Request ID: 7312e684-b079-11e8-95a6-5baf58bb2ca8<span class="o">)</span>
</code></pre></div></div>

<p>Solution: Input <strong>Instance Profile ARN</strong> value of <code class="highlighter-rouge">BaseIAMRole</code> into <code class="highlighter-rouge">Bookstore Test to Dev &gt; Deploy stage &gt; Advanced Settings &gt; IAM Instance Profile</code> field (e.g. <code class="highlighter-rouge">arn:aws:iam::709203678428:instance-profile/BaseIAMRole</code>).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User: arn:aws:iam::709203678428:user/SpinnakerDevelopment-SpinnakerUser-18ZQ3LBIXDZZV is not authorized to perform: iam:PassRole on resource: arn:aws:iam::709203678428:role/BaseIAMRole <span class="o">(</span>Service: AmazonAutoScaling<span class="p">;</span> Status Code: 403<span class="p">;</span> Error Code: AccessDenied<span class="p">;</span> Request ID: 01c151d9-b07c-11e8-960b-0d81eade5556<span class="o">)</span>
</code></pre></div></div>

<p>Solution:</p>

<ul>
  <li>Navigate to <strong>AWS &gt; IAM &gt; Users &gt; SpinnakerDevelopment-SpinnakerUser-18ZQ3LBIXDZZV &gt; Permissions</strong>.</li>
  <li>Expand <code class="highlighter-rouge">Spinnakerpassrole</code> policy and click <strong>Edit Policy</strong>.</li>
  <li>Select the <strong>JSON</strong> tab and you’ll see the auto-generated <code class="highlighter-rouge">SpinnakerDevelopment-BaseIAMRole</code> listed in <code class="highlighter-rouge">Resources</code>.</li>
  <li>Add a new line for the <code class="highlighter-rouge">BaseIAMRole</code> we added previously, like so:</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iam:PassRole"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"arn:aws:iam::123456789012:role/SpinnakerDevelopment-BaseIAMRole-6D9LJ9HS4PZ7"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"arn:aws:iam::123456789012:role/BaseIAMRole"</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Click <strong>Review policy</strong> and then click <strong>Save changes</strong>.</li>
  <li><code class="highlighter-rouge">Deploy</code> stage should now succeed.</li>
</ul>

<p><strong>Failed CloudDriver</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl list-units <span class="nt">--state</span><span class="o">=</span>failed
  UNIT                LOAD   ACTIVE SUB    DESCRIPTION
● clouddriver.service loaded failed failed Spinnaker Clouddriver

LOAD   <span class="o">=</span> Reflects whether the unit definition was properly loaded.
ACTIVE <span class="o">=</span> The high-level unit activation state, i.e. generalization of SUB.
SUB    <span class="o">=</span> The low-level unit activation state, values depend on unit type.

1 loaded units listed. Pass <span class="nt">--all</span> to see loaded but inactive units, too.
To show all installed unit files use <span class="s1">'systemctl list-unit-files'</span><span class="nb">.</span>
</code></pre></div></div>

<h2 id="how-to-deploy-chaos-monkey">How to Deploy Chaos Monkey</h2>

<ol>
  <li>Once your application is up and running through Spinnaker, you can</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>chaosmonkey migrate
<span class="o">[</span>16264] 2018/09/04 14:11:16 Successfully applied database migrations. Number of migrations applied:  0
<span class="o">[</span>16264] 2018/09/04 14:11:16 database migration applied successfully
</code></pre></div></div>

<h2 id="manual-spinnaker-installation">Manual Spinnaker Installation</h2>

<p><strong><em>TODO</em></strong>: https://www.spinnaker.io/setup/install/</p>

<h3 id="chaos-monkey--go--mysql-8-authentication-error">Chaos Monkey + Go + MySQL 8 Authentication Error</h3>

<p>See: <a href="https://github.com/go-sql-driver/mysql/issues/785">#785</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ 6593] 2018/09/04 13:26:03 ERROR - couldn't apply database migration: database migration failed: this authentication plugin is not supported
</code></pre></div></div>

<p>Solution: Add <code class="highlighter-rouge">default-authentication-plugin = mysql_native_password</code> directive to <code class="highlighter-rouge">[mysqld]</code> section of <code class="highlighter-rouge">/etc/mysql/mysql.conf.d/mysqld.cnf</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysqld]
default-authentication-plugin = mysql_native_password
</code></pre></div></div>

<div class="premonition warning modified"><div class="fa fa-exclamation-circle"></div><div class="content"><p class="header">Warning</p><p>Chaos Monkey is currently <em>incompatible</em> with MySQL version 8.0 and higher.</p></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[16097] 2018/09/04 14:07:43 ERROR - couldn't apply database migration: database migration failed: Error 1298: Unknown or incorrect time zone: 'UTC'
</code></pre></div></div>
<p>Solution: Add timezone info to MySQL by executing the following command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysql_tzinfo_to_sql /usr/share/zoneinfo/|mysql <span class="nt">-u</span> root mysql <span class="nt">-p</span>
Enter password: 
Warning: Unable to load <span class="s1">'/usr/share/zoneinfo//iso3166.tab'</span> as <span class="nb">time </span>zone. Skipping it.
Warning: Unable to load <span class="s1">'/usr/share/zoneinfo//leap-seconds.list'</span> as <span class="nb">time </span>zone. Skipping it.
Warning: Unable to load <span class="s1">'/usr/share/zoneinfo//zone.tab'</span> as <span class="nb">time </span>zone. Skipping it.
Warning: Unable to load <span class="s1">'/usr/share/zoneinfo//zone1970.tab'</span> as <span class="nb">time </span>zone. Skipping it.
</code></pre></div></div>

<p>Alter <code class="highlighter-rouge">chaosmonkey</code> MySQL 8 user’s identification policy to <code class="highlighter-rouge">mysql_native_password</code>.  Note: This is inherently less secure than the default policy.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; ALTER USER chaosmonkey@<span class="s1">'localhost'</span> IDENTIFIED WITH mysql_native_password by <span class="s1">'password'</span><span class="p">;</span>
Query OK, 0 rows affected <span class="o">(</span>0.03 sec<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; ALTER USER root@<span class="s1">'localhost'</span> IDENTIFIED WITH mysql_native_password by <span class="s1">'password'</span><span class="p">;</span>
Query OK, 0 rows affected <span class="o">(</span>0.03 sec<span class="o">)</span>
</code></pre></div></div>

<h2 id="spinnaker-full-installation-via-aws-cli">Spinnaker Full Installation via AWS CLI</h2>

<h3 id="create-aws-cloudformation-spinnaker-stack">Create AWS CloudFormation Spinnaker Stack</h3>

<ol>
  <li>If needed, install the <a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html">AWS CLI tool</a> on your machine.</li>
</ol>

<div class="premonition info modified"><div class="fa fa-info-circle"></div><div class="content"><p class="header">Simplifying AWS Credentials</p><p>You can make future AWS CLI commands easier by creating AWS <code class="highlighter-rouge">profiles</code>, which will add configuration and credentials to the local <code class="highlighter-rouge">~/.aws/credentials</code> file.  We’ll be using two different accounts/profiles (<code class="highlighter-rouge">primary</code> or root AWS console account and <code class="highlighter-rouge">spinnaker-developer</code> as a managed account), so we can add credentials for both of these to <code class="highlighter-rouge">~/.aws/credentials</code> by using <code class="highlighter-rouge">aws configure --profile &lt;profile-name&gt;</code> commands.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure <span class="nt">--profile</span> spinnaker-developer
AWS Access Key ID <span class="o">[</span>None]: &lt;AWS_ACCESS_KEY_ID&gt;
AWS Secret Access Key <span class="o">[</span>None]: &lt;AWS_SECRET_ACCESS_KEY&gt;
Default region name <span class="o">[</span>None]: us-west-2
Default output format <span class="o">[</span>None]: text
   
aws configure <span class="nt">--profile</span> primary
AWS Access Key ID <span class="o">[</span>None]: &lt;AWS_ACCESS_KEY_ID&gt;
AWS Secret Access Key <span class="o">[</span>None]: &lt;AWS_SECRET_ACCESS_KEY&gt;
Default region name <span class="o">[</span>None]: us-west-2
Default output format <span class="o">[</span>None]: text
</code></pre></div></div>

<p>In the future, simply add the <code class="highlighter-rouge">--profile &lt;profile-name&gt;</code> flag to any AWS CLI command to force AWS CLI to use that account.</p></div></div>

<ol>
  <li>Download <a href="https://d3079gxvs8ayeg.cloudfront.net/templates/managing.yaml">this</a> <code class="highlighter-rouge">managing.yaml</code> template.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-OL</span> https://d3079gxvs8ayeg.cloudfront.net/templates/managing.yaml
</code></pre></div></div>

<ol>
  <li>Now we’ll use AWS CLI to create the <code class="highlighter-rouge">spinnaker-managing-infrastructure</code> stack via CloudFormation.  We want to use the <code class="highlighter-rouge">primary</code> or managing account for this, so we’ll specify the <code class="highlighter-rouge">--profile primary</code>, which will grab the appropriate credentials, region, and so forth:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws cloudformation deploy <span class="nt">--stack-name</span> spinnaker-managing-infrastructure <span class="nt">--template-file</span> managing.yaml <span class="nt">--parameter-overrides</span> <span class="nv">UseAccessKeyForAuthentication</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--capabilities</span> CAPABILITY_NAMED_IAM <span class="nt">--profile</span> primary

Waiting <span class="k">for </span>changeset to be created..
Waiting <span class="k">for </span>stack create/update to <span class="nb">complete
</span>Successfully created/updated stack - spinnaker-managing-infrastructure
</code></pre></div></div>

<div class="premonition errpr modified"><div class="fa fa-check-square"></div><div class="content"><p>If you receive an <code class="highlighter-rouge">Unresolved resource dependency</code> error while creating the <code class="highlighter-rouge">spinnaker-managing-infrastructure</code> stack related to the <code class="highlighter-rouge">SpinnakerInstanceProfile</code> you may need to edit the <code class="highlighter-rouge">managing.yaml</code> file and comment out the two <code class="highlighter-rouge">SpinnakerInstanceProfileArn</code> related lines under the <code class="highlighter-rouge">Outputs</code> block.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ...</span>
Outputs:
<span class="c"># ...</span>
<span class="c">#  SpinnakerInstanceProfileArn:</span>
<span class="c">#    Value: !GetAtt SpinnakerInstanceProfile.Arn</span>
</code></pre></div></div></div></div>

<ol>
  <li>Once the <code class="highlighter-rouge">spinnaker-managing-infrastructure</code> stack has been created open the AWS console, navigate to the <code class="highlighter-rouge">CloudFormation</code> service, select the <strong>Outputs</strong> tab of the <code class="highlighter-rouge">spinnaker-managing-infrastructure</code> stack.  We’ll be using the <code class="highlighter-rouge">ManagingAccountId</code> and <code class="highlighter-rouge">AuthArn</code> values in the next step, which look something like the following:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ManagingAccountId</td>
      <td>123456789012</td>
    </tr>
    <tr>
      <td>AuthArn</td>
      <td>arn:aws:iam::123456789012:user/spinnaker-managing-infrastructure-SpinnakerUser-15UU17KIS3EK1</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>Download <a href="https://d3079gxvs8ayeg.cloudfront.net/templates/managed.yaml">this</a> <code class="highlighter-rouge">managed.yaml</code> template.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-OL</span> https://d3079gxvs8ayeg.cloudfront.net/templates/managed.yaml
</code></pre></div></div>

<ol>
  <li>Now enter the following command to create the companion <code class="highlighter-rouge">spinnaker-managed-infrastructure</code> stack in CloudFormation.  Be sure to specify the appropriate <strong>profile</strong> value and paste the appropriate <code class="highlighter-rouge">ManagingAccountId</code> and <code class="highlighter-rouge">AuthArn</code> values from above:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws cloudformation deploy <span class="nt">--stack-name</span> spinnaker-managed-infrastructure <span class="nt">--template-file</span> managed.yaml <span class="se">\</span>
<span class="nt">--capabilities</span> CAPABILITY_NAMED_IAM <span class="nt">--profile</span> spinnaker-developer <span class="nt">--parameter-overrides</span> <span class="se">\</span>
<span class="nv">AuthArn</span><span class="o">=</span>&lt;ManagingStack_AuthArnValue&gt; <span class="se">\</span>
<span class="nv">ManagingAccountId</span><span class="o">=</span>&lt;ManagingStack_ManagingAccountId&gt;

Waiting <span class="k">for </span>changeset to be created..
Waiting <span class="k">for </span>stack create/update to <span class="nb">complete
</span>Successfully created/updated stack - spinnaker-managed-infrastructure
</code></pre></div></div>

<ol>
  <li>Add your AWS Access and Secret Keys to Halyard:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config provider aws edit <span class="nt">--access-key-id</span> &lt;AWS_ACCESS_KEY_ID&gt; <span class="nt">--secret-access-key</span>
Your AWS Secret Key.. Note that <span class="k">if </span>you are baking AMI<span class="s1">'s via Rosco, you may also need to set the secret key on the AWS bakery default options.:
+ Get current deployment
  Success
+ Get the aws provider
  Success
+ Edit the aws provider
  Success
+ Successfully edited provider aws.
</span></code></pre></div></div>

<ol>
  <li>Add your default managing account to Spinnaker:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config provider aws account add default <span class="nt">--account-id</span> 123456789012 <span class="nt">--assume-role</span> role/spinnakerManaged <span class="nt">--regions</span> us-west-2
+ Get current deployment
  Success
+ Add the default account
  Success
Problems <span class="k">in </span>default.provider.aws.default:
- WARNING No validation <span class="k">for </span>the AWS provider has been
  implemented.

+ Successfully added account default <span class="k">for </span>provider aws.
</code></pre></div></div>

<div class="premonition info modified"><div class="fa fa-info-circle"></div><div class="content"><p>Spinnaker uses <code class="highlighter-rouge">accounts</code> added via the Halyard <code class="highlighter-rouge">hal config provider aws account</code> API to handle all actions performed within the specified provider (such as AWS, in this case).  For this example we’ll just be using our primary managing account, but you can freely add more accounts as needed.</p></div></div>

<ol>
  <li>Finally, enable the AWS provider:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config provider aws <span class="nb">enable</span>
+ Get current deployment
  Success
+ Edit the aws provider
  Success
Problems <span class="k">in </span>default.provider.aws.default:
- WARNING No validation <span class="k">for </span>the AWS provider has been
  implemented.

+ Successfully enabled aws
</code></pre></div></div>

<h3 id="select-installation-environment">Select Installation Environment</h3>

<p>In this step you can choose which type of environment on which you want to install Spinnaker.  Most production setups will want to use Kubernetes or another distributed solution, but for this smaller example we’ll just use a local Debian installation, putting Spinnaker on the same machine that Halyard is on.</p>

<div class="premonition info modified"><div class="fa fa-info-circle"></div><div class="content"><p>By default, Halyard should install as a local Debian environmental setup, so you shouldn’t need to make any changes for the environment.  However, if you want to verify it’s already configured locally you can run the <code class="highlighter-rouge">hal config deploy edit --type localdebian</code> command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config deploy edit <span class="nt">--type</span> localdebian
+ Get current deployment
  Success
+ Get the deployment environment
  Success
- No changes supplied.
</code></pre></div></div></div></div>

<h3 id="setup-persistent-storage-for-spinnaker">Setup Persistent Storage for Spinnaker</h3>

<ol>
  <li>Add <code class="highlighter-rouge">s3</code> storage configuration to Halyard (you’ll be prompted to paste your secret key after entry).</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config storage s3 edit <span class="nt">--access-key-id</span> &lt;AWS_ACCESS_KEY_ID&gt; <span class="nt">--secret-access-key</span> <span class="nt">--region</span> us-west-2
Your AWS Secret Key.:
+ Get current deployment
  Success
+ Get persistent store
  Success
Generated bucket name: spin-6d40b949-3e2d-4240-96f6-1b9467572b79
+ Edit persistent store
  Success
Problems <span class="k">in </span>default.persistentStorage:
- WARNING Your deployment will most likely fail <span class="k">until </span>you configure
  and <span class="nb">enable </span>a persistent store.

+ Successfully edited persistent store <span class="s2">"s3"</span><span class="nb">.</span>
</code></pre></div></div>

<ol>
  <li>Tell halyard to use <code class="highlighter-rouge">--type s3</code> storage:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config storage edit <span class="nt">--type</span> s3
+ Get current deployment
  Success
+ Get persistent storage settings
  Success
+ Edit persistent storage settings
  Success
+ Successfully edited persistent storage.
</code></pre></div></div>

<h3 id="deploy-spinnaker">Deploy Spinnaker</h3>

<ol>
  <li>Use the <code class="highlighter-rouge">hal version list</code> command to view the current Spinnaker version list:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal version list
+ Get current deployment
  Success
+ Get Spinnaker version
  Success
+ Get released versions
  Success
+ You are on version <span class="s2">""</span>, and the following are available:
 - 1.7.8 <span class="o">(</span>Ozark<span class="o">)</span>:
   Changelog: https://gist.github.com/spinnaker-release/75f98544672a4fc490d451c14688318e
   Published: Wed Aug 29 19:09:57 UTC 2018
   <span class="o">(</span>Requires Halyard <span class="o">&gt;=</span> 1.0.0<span class="o">)</span>
 - 1.8.6 <span class="o">(</span>Dark<span class="o">)</span>:
   Changelog: https://gist.github.com/spinnaker-release/0844fadacaf2299d214a82e88217d97c
   Published: Wed Aug 29 19:11:34 UTC 2018
   <span class="o">(</span>Requires Halyard <span class="o">&gt;=</span> 1.0.0<span class="o">)</span>
 - 1.9.2 <span class="o">(</span>Bright<span class="o">)</span>:
   Changelog: https://gist.github.com/spinnaker-release/9323c90ab2088d89e68ce2a7ef7e5809
   Published: Wed Aug 29 20:08:18 UTC 2018
   <span class="o">(</span>Requires Halyard <span class="o">&gt;=</span> 1.0.0<span class="o">)</span>
</code></pre></div></div>

<ol>
  <li>Configure halyard to use version <code class="highlighter-rouge">1.9.2</code> of Spinnaker:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config version edit <span class="nt">--version</span> 1.9.2
+ Get current deployment
  Success
+ Edit Spinnaker version
  Success
+ Spinnaker has been configured to update/install version <span class="s2">"1.9.2"</span><span class="nb">.</span>
  Deploy this version of Spinnaker with <span class="sb">`</span>hal deploy apply<span class="sb">`</span><span class="nb">.</span>
</code></pre></div></div>

<ol>
  <li>Add Chaos Monkey enabled flag to halyard config:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config features edit <span class="nt">--chaos</span> <span class="nb">true</span>
+ Get current deployment
  Success
+ Get features
  Success
+ Edit features
  Success
+ Successfully updated features.
</code></pre></div></div>

<ol>
  <li>Now use <code class="highlighter-rouge">sudo hal deploy apply</code> to deploy Spinnaker to the local machine:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>hal deploy apply

+ Get current deployment
  Success
+ Prep deployment
  Success
Problems <span class="k">in </span>default.provider.aws.spinnaker-developer:
- WARNING No validation <span class="k">for </span>the AWS provider has been
  implemented.

+ Preparation complete... deploying Spinnaker
+ Get current deployment
  Success
+ Apply deployment
  Success
+ Run <span class="sb">`</span>hal deploy connect<span class="sb">`</span> to connect to Spinnaker.
...
</code></pre></div></div>

<ol>
  <li>After deployment finishes you should have a functioning Spinnaker installation!  Navigate to <a href="http://localhost:9000">localhost:9000</a> to see it in action.  If necessary, you may need to setup an SSH tunnel to the Halyard/Spinnaker EC2 instance.</li>
</ol>

<h2 id="spinnaker-full-installation">Spinnaker Full Installation</h2>

<h3 id="install-halyard">Install Halyard</h3>

<p>https://www.spinnaker.io/setup/install/halyard/</p>

<ol>
  <li>Download Halyard installation script.
    <ul>
      <li>For Debian/Ubuntu: <code class="highlighter-rouge">$ curl -O https://raw.githubusercontent.com/spinnaker/halyard/master/install/debian/InstallHalyard.sh</code></li>
      <li>For MacOS: <code class="highlighter-rouge">$ curl -O https://raw.githubusercontent.com/spinnaker/halyard/master/install/macos/InstallHalyard.sh</code></li>
    </ul>
  </li>
  <li>Install Halyard: <code class="highlighter-rouge">$ sudo bash InstallHalyard.sh</code>
    <ul>
      <li>If prompted, default values are typically OK.</li>
    </ul>
  </li>
  <li>Source your <code class="highlighter-rouge">.bashrc</code> file by inputting: <code class="highlighter-rouge">$ . ~/.bashrc</code>.</li>
  <li>Verify Halyard was installed by checking the version.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal <span class="nt">-v</span>
1.9.1-20180830145737
</code></pre></div></div>

<h3 id="create-aws-cloudformation-spinnaker-stack-1">Create AWS CloudFormation Spinnaker Stack</h3>

<ol>
  <li>In AWS navigate to <strong>CloudFormation</strong> and click <strong>Create Stack</strong>.</li>
  <li>Download <a href="https://d3079gxvs8ayeg.cloudfront.net/templates/managing.yaml">this</a> <code class="highlighter-rouge">managing.yaml</code> file to your local machine.</li>
  <li>Under <strong>Choose a template</strong> click the <strong>Choose File</strong> button under <strong>Upload a template to Amazon S3</strong> and select the downloaded <code class="highlighter-rouge">managing.yaml</code>.</li>
  <li>Click <strong>Next</strong>.</li>
  <li>Input <code class="highlighter-rouge">spinnaker-managing-infrastructure-setup</code> into the <strong>Stack name</strong> field.</li>
  <li>Select <code class="highlighter-rouge">false</code> in the <strong>UseAccessKeyForAuthentication</strong> dropdown.</li>
  <li>Click <strong>Next</strong>.</li>
  <li>On the <strong>Options</strong> screen leave defaults and click <strong>Next</strong>, again.</li>
  <li>Check the <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names.</strong> checkbox and click <strong>Create</strong> to generate the stack.
    <ul>
      <li><em>Note: If your AWS account already contains the <code class="highlighter-rouge">BaseIAMRole</code> AWS::IAM::ROLE you may have to delete it before this template will succeed.</em></li>
    </ul>
  </li>
  <li>Once the <code class="highlighter-rouge">spinnaker-managing-infrastructure-setup</code> stack has a <code class="highlighter-rouge">CREATE_COMPLETE</code> <strong>Status</strong>, select the <strong>Outputs</strong> tab and copy all <code class="highlighter-rouge">key/value</code> pairs there somewhere convenient.  They’ll look something like the following:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>VpcId</td>
      <td>vpc-0eff1ddd5f7b26ffc</td>
    </tr>
    <tr>
      <td>ManagingAccountId</td>
      <td>123456789012</td>
    </tr>
    <tr>
      <td>AuthArn</td>
      <td>arn:aws:iam::123456789012:role/SpinnakerAuthRole</td>
    </tr>
    <tr>
      <td>SpinnakerInstanceProfileArn</td>
      <td>arn:aws:iam::123456789012:instance-profile/spinnaker-managing-infrastructure-setup-SpinnakerInstanceProfile-1M72QQCCLNCZ9</td>
    </tr>
    <tr>
      <td>SubnetIds</td>
      <td>subnet-0c5fb1e7ab00f20a7,subnet-065af1a1830937f86</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>Add a new AWS account to halyard named <code class="highlighter-rouge">spinnaker-developer</code> with your AWS account id and your appropriate AWS region name:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config provider aws account add spinnaker-developer <span class="se">\</span>
  <span class="nt">--account-id</span> 123456789012 <span class="se">\</span>
  <span class="nt">--assume-role</span> role/spinnakerManaged <span class="se">\</span>
  <span class="nt">--regions</span> us-west-2
+ Get current deployment
  Success
+ Add the spinnaker-developer account
  Success
Problems <span class="k">in </span>default.provider.aws.spinnaker-developer:
- WARNING No validation <span class="k">for </span>the AWS provider has been
  implemented.

+ Successfully added account spinnaker-developer <span class="k">for </span>provider
  aws.
</code></pre></div></div>

<ol>
  <li>Enable AWS in halyard:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config provider aws <span class="nb">enable</span>
+ Get current deployment
  Success
+ Edit the aws provider
  Success
Problems <span class="k">in </span>default.provider.aws.spinnaker-developer:
- WARNING No validation <span class="k">for </span>the AWS provider has been
  implemented.

+ Successfully enabled aws
</code></pre></div></div>

<h3 id="setup-persistent-storage-for-spinnaker-1">Setup Persistent Storage for Spinnaker</h3>

<ol>
  <li>For this example you’ll need access to an <code class="highlighter-rouge">AWS::IAM::Role</code> with full S3 access.
    <ol>
      <li>If necessary, navigate to <strong>AWS &gt; IAM &gt; Roles</strong> and click <strong>Create role</strong>.</li>
      <li>Select <strong>AWS Service &gt; S3</strong> and click <strong>Next: Permissions</strong>.</li>
      <li>Filter policies with <code class="highlighter-rouge">S3</code> and select the <code class="highlighter-rouge">AmazonS3FullAccess</code> policy then click <strong>Next: Review</strong>.</li>
      <li>Input <code class="highlighter-rouge">s3-full-access</code> in the <strong>Role name</strong> field and click <strong>Create role</strong>.</li>
    </ol>
  </li>
  <li>Add <code class="highlighter-rouge">s3</code> storage configuration to halyard (you’ll be prompted to paste your secret key after entry):</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config storage s3 edit     <span class="nt">--access-key-id</span> &lt;AWS-account-access-key-id&gt;     <span class="nt">--secret-access-key</span>     <span class="nt">--region</span> us-west-2
Your AWS Secret Key.:
+ Get current deployment
  Success
+ Get persistent store
  Success
Generated bucket name: spin-6d40b949-3e2d-4240-96f6-1b9467572b79
+ Edit persistent store
  Success
Problems <span class="k">in </span>default.persistentStorage:
- WARNING Your deployment will most likely fail <span class="k">until </span>you configure
  and <span class="nb">enable </span>a persistent store.

+ Successfully edited persistent store <span class="s2">"s3"</span><span class="nb">.</span>
</code></pre></div></div>

<ol>
  <li>Lastly, tell halyard to use <code class="highlighter-rouge">--type s3</code> storage:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config storage edit <span class="nt">--type</span> s3
+ Get current deployment
  Success
+ Get persistent storage settings
  Success
+ Edit persistent storage settings
  Success
+ Successfully edited persistent storage.
</code></pre></div></div>

<h3 id="deploy-spinnaker-1">Deploy Spinnaker</h3>

<ol>
  <li>Use the <code class="highlighter-rouge">hal version list</code> command to view the current Spinnaker version list:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal version list
+ Get current deployment
  Success
+ Get Spinnaker version
  Success
+ Get released versions
  Success
+ You are on version <span class="s2">""</span>, and the following are available:
 - 1.7.8 <span class="o">(</span>Ozark<span class="o">)</span>:
   Changelog: https://gist.github.com/spinnaker-release/75f98544672a4fc490d451c14688318e
   Published: Wed Aug 29 19:09:57 UTC 2018
   <span class="o">(</span>Requires Halyard <span class="o">&gt;=</span> 1.0.0<span class="o">)</span>
 - 1.8.6 <span class="o">(</span>Dark<span class="o">)</span>:
   Changelog: https://gist.github.com/spinnaker-release/0844fadacaf2299d214a82e88217d97c
   Published: Wed Aug 29 19:11:34 UTC 2018
   <span class="o">(</span>Requires Halyard <span class="o">&gt;=</span> 1.0.0<span class="o">)</span>
 - 1.9.2 <span class="o">(</span>Bright<span class="o">)</span>:
   Changelog: https://gist.github.com/spinnaker-release/9323c90ab2088d89e68ce2a7ef7e5809
   Published: Wed Aug 29 20:08:18 UTC 2018
   <span class="o">(</span>Requires Halyard <span class="o">&gt;=</span> 1.0.0<span class="o">)</span>
</code></pre></div></div>

<ol>
  <li>Configure halyard to use version <code class="highlighter-rouge">1.9.2</code> of Spinnaker:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config version edit <span class="nt">--version</span> 1.9.2
+ Get current deployment
  Success
+ Edit Spinnaker version
  Success
+ Spinnaker has been configured to update/install version <span class="s2">"1.9.2"</span><span class="nb">.</span>
  Deploy this version of Spinnaker with <span class="sb">`</span>hal deploy apply<span class="sb">`</span><span class="nb">.</span>
</code></pre></div></div>

<ol>
  <li>Add Chaos Monkey enabled flag to halyard config:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>hal config features edit <span class="nt">--chaos</span> <span class="nb">true</span>
+ Get current deployment
  Success
+ Get features
  Success
+ Edit features
  Success
+ Successfully updated features.
</code></pre></div></div>

<ol>
  <li>Now use <code class="highlighter-rouge">sudo hal deploy apply</code> to deploy Spinnaker to the local machine:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>hal deploy apply

+ Get current deployment
  Success
+ Prep deployment
  Success
Problems <span class="k">in </span>default.provider.aws.spinnaker-developer:
- WARNING No validation <span class="k">for </span>the AWS provider has been
  implemented.

+ Preparation complete... deploying Spinnaker
+ Get current deployment
  Success
+ Apply deployment
  Success
+ Run <span class="sb">`</span>hal deploy connect<span class="sb">`</span> to connect to Spinnaker.
...
</code></pre></div></div>

<ol>
  <li>After deployment completes you should have a functioning Spinnaker installation!  Navigate to <a href="http://localhost:9000">localhost:9000</a> to see it in action.  If necessary, you may need to setup an SSH tunnel to the Halyard/Spinnaker EC2 instance.</li>
</ol>

<h3 id="create-spinnaker-application">Create Spinnaker Application</h3>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/gremlin-chaos-monkey/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Gremlin: Chaos Monkey</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Gremlin: Chaos Monkey</li><li><a class="u-email" href="mailto:gabe@gabewyatt.com">gabe@gabewyatt.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/gabestah"><svg class="svg-icon"><use xlink:href="/gremlin-chaos-monkey/assets/minima-social-icons.svg#github"></use></svg> <span class="username">gabestah</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
